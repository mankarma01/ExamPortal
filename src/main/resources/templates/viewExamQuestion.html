<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:insert="~{include/head}" >
  <title>Home</title>
</head>

<body>

  <!-- ======= Header ======= -->
  <header th:insert="~{include/header}"  id="header" class="header fixed-top d-flex align-items-center"></header>
  <!-- End Header -->

  <!-- ======= Sidebar ======= -->
  <aside id="sidebar" class="sidebar" th:insert="~{include/sidebar}"></aside><!-- End Sidebar-->

  <main id="main" class="main">
    <div class="pagetitle">
      <h1>Question Report Set-(<span th:text="${examSet}"></span>)</h1>
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="/home">Home</a></li>
          <li class="breadcrumb-item"><a href="/exam">Exam Report</a></li>
          <li class="breadcrumb-item active">Question Set-(<span th:text="${examSet}"></span>)</li>
        </ol>
      </nav>
    </div><!-- End Page Title -->


    <div class="tab-content pt-2">

      <div class="tab-pane fade show active profile-overview d-flex justify-content-center" id="profile-overview">
        <div class="col-lg-6 col-md-10 col-12 row">
          <div class="col-lg-3 col-md-4 col-5 label "><b>Exam Title :</b></div>
          <div class="col-lg-9 col-md-8 col-7" ><span th:text="${exam.title}"></span></div>
          <div class="col-lg-3 col-md-4 col-5 label"><b>Exam Date :</b></div>
          <div class="col-lg-9 col-md-8 col-7" ><span th:text="${exam.examDate}"></span></div>
          <div class="col-lg-3 col-md-4 col-5 label"><b>Total Time :</b></div>
          <div class="col-lg-9 col-md-8 col-7" ><span th:text="${exam.totalTime}"></span><span> Minutes</span></div>
        </div>

        <!--        <div class="row">
                  <div class="col-lg-3 col-md-4 label">Description</div>
                  <div class="col-lg-9 col-md-8" ><span th:text="${exam.description}"></span></div>
                </div>-->

      </div>
    </div>

    <section class="section mt-3">
      <div class="row">
        <div class="col-lg-12">

          <div class="card">
            <div class="card-body scrollable-table">

              <div class="col-lg-12 text-center"><h5 class="card-title" style="padding:0px;">Add Question</h5></div>

              <table class="table" id="questionUpdate">
                <thead>
                <tr>
                  <th style="min-width: 300px;">Question</th>
                  <th>Option(A)</th>
                  <th>Option(B)</th>
                  <th>Option(C)</th>
                  <th>Option(D)</th>
                  <th>Answer</th>
                  <th>Add</th>
                </tr>
                </thead>

                <tbody>
                <tr>
                  <td><input type="text" class="form-control" id="question"></td>
                  <td><input type="text" class="form-control" id="option1"></td>
                  <td><input type="text" class="form-control" id="option2"></td>
                  <td><input type="text" class="form-control" id="option3"></td>
                  <td><input type="text" class="form-control" id="option4"></td>
                  <td><input type="text" class="form-control" id="correctAnswer">
                    <input type="hidden" class="form-control" id="questionId"></td>
                  <td><button class="btn btn-primary w-100" id="addQuestion">Submit</button></td>
                  <td><button class="btn btn-primary w-100" id="clearForm">Clear</button></td>
                </tr>
                </tbody>
              </table>
              <!-- End Table with stripped rows -->
            </div>
          </div>

        </div>
      </div>

    </section>

    <form id="formData">
      <h5 class="card-title">If you want to delete the above questions and insert new ones, please upload a CSV file.</h5>

      <div class="form-floating mb-3">
        <input type="file" class="form-control" id="file" name="file" placeholder="Enter exam title">
        <label for="file">Select CSV question file</label>
      </div>

      <input type="hidden" id="examId" th:value="${examId}" name="examId">
      <input type="hidden" id="examSet" th:value="${examSet}" name="examSet">

      <div class="col-lg-2 col-md-3 col-5 mb-2">
        <button class="btn btn-primary w-100" type="submit">SUBMIT CSV</button>
      </div>

    </form>

    <section class="section mt-3">
      <div class="row">
        <div class="col-lg-12">

          <div class="card">
            <div class="card-body scrollable-table">

              <table class="table datatable" id="examTable">
                <thead>
                <tr>
                  <th>No.</th>
                  <th style="min-width: 300px;">Question</th>
                  <th>Option(A)</th>
                  <th>Option(B)</th>
                  <th>Option(C)</th>
                  <th>Option(D)</th>
                  <th>Answer</th>
                 <!-- <th>update</th>-->
                  <th>Delete<a href="" title="Delete all" th:onclick="deleteQuestionByExamSet();">
                    <i class="bi bi-trash-fill" style="color:red;margin-left:5px;"></i></a><span></span>
                  </th>
                </tr>
                </thead>
                <tbody>

                <tr th:each="question, stat : ${questionList}">
                  <td th:text="${stat.index + 1}"></td>
                  <td th:text="${question.question}"></td>
                  <td th:text="${question.option1}"></td>
                  <td th:text="${question.option2}"></td>
                  <td th:text="${question.option3}"></td>
                  <td th:text="${question.option4}"></td>
                  <td th:text="${question.correctAnswer}"></td>
                  <!-- Edit Button -->
                  <!-- Uncomment the edit button below if needed -->
                  <!-- <td><a href=""><i class="bi bi-pencil-square" style="margin-left: 5px;"></i></a></td> -->
                  <!-- Delete Button -->
                  <td>
                    <a href=""
                       th:onclick="|deleteQuestion('${question.questionId}')|">
                      <i class="bi bi-trash-fill" style="margin-left:5px;"></i>
                    </a>
                  </td>

                  <!-- Date Example -->
                  <!-- Uncomment if needed -->
                  <!-- <td th:text="${#dates.format(exam.examDate, 'yyyy-MM-dd')}"></td> -->
                </tr>

                </tbody>
              </table>
              <!-- End Table with stripped rows -->
            </div>
          </div>
        </div>
      </div>
    </section>

  </main>
  <!-- ======= Footer ======= -->
  <footer id="footer" class="footer" th:insert="~{include/footer}">

  </footer>

  <script>
    $(document).ready(function () {
      $('#formData').on('submit', function (event) {
        event.preventDefault(); // Prevent default form submission

        var formData = new FormData(this);

        $.ajax({
          url: baseUrl + 'questionAPI/uploadCSV', // Replace with your API endpoint
          type: 'POST',
          data: formData,
          processData: false,
          contentType: false,
          success: function (response) {
              if (response.result) {
                 // alert(response.message);
                  alert('File uploaded successfully: ' + response.message);
                  window.location.reload();
              } else {
                  alert('Operation failed: ' + response.message);
                  window.location.reload();
              }
          },
          error: function (xhr, status, error) {
            alert('Error uploading file: ' + xhr.responseText || error);
          }
        });
      });
    });
  </script>

  <script>
    $(document).ready(function () {
  $('#addQuestion').on('click', function (event) {
    event.preventDefault(); // Prevent default form submission

    // Create the JSON object
    const Option = {
      question: $('#question').val(),
      option1: $('#option1').val(),
      option2: $('#option2').val(),
      option3: $('#option3').val(),
      option4: $('#option4').val(),
      correctAnswer: $('#correctAnswer').val(),
      examId: $('#examId').val(),
      examSet: $('#examSet').val()
    };

    // Validate inputs (optional)
    if (!Option.question || !Option.option1 || !Option.option2 || !Option.option3 || !Option.option4 || !Option.correctAnswer) {
      alert('All fields are required.');
      return;
    }

    // Send JSON object via AJAX
    $.ajax({
      url: baseUrl + 'questionAPI/create', // Replace with your endpoint
      method: 'POST',
      contentType: 'application/json',
      data: JSON.stringify(Option),
      success: function (response) {
       if (response.result) {
                       // alert(response.message);
                        alert('Question added successfully.');
                       // $('#question, #option1, #option2, #option3, #option4, #correctAnswer').val('');
                       window.location.reload();
                    } else {
                        alert('Operation failed: ' + response.message);
                    }
      },
      error: function (error) {
        alert('Failed to add question. Please try again.');
      }
    });
  });
});

  </script>

  <script>
    function deleteQuestion(questionId) {
        // Confirm before deleting
        if (confirm("Are you sure you want to delete this question?")) {
            $.ajax({
                url: baseUrl + 'questionAPI/delete/' + questionId, // Replace with your actual API endpoint
                type: 'DELETE', // HTTP method
                success: function(response) {
                    // Handle success (e.g., show a message, reload the table, etc.)
                    alert("Question deleted successfully!");
                    window.location.reload(); // Reload the page or update the UI dynamically
                },
                error: function(xhr, status, error) {
                    // Handle error
                    console.error("Error deleting question:", error);
                    alert("Failed to delete the question. Please try again.");
                }
            });
        }
    }

      function deleteQuestionByExamSet() {
      let examId = $('#examId').val();
      let examSet = $('#examSet').val();

        if (confirm("Are you sure you want to delete all question of the set ?")) {
            $.ajax({
                url: baseUrl + 'questionAPI/deleteAll/'+examId+'/'+examSet,
                type: 'DELETE',
                success: function(response) {
                    alert("Questions deleted successfully!");
                    window.location.reload();
                },
                error: function(xhr, status, error) {

                    console.error("Error deleting question:", error);
                    alert("Failed to delete the question. Please try again.");
                }
            });
        }
    }



  </script>

<!--
  <script>
    $(document).ready(function () {
  $('#deleteQuestion').on('click', function (event) {
    event.preventDefault(); // Prevent default form submission
    alert();

    // Create the JSON object
    const Option = {
      question: $('#question').val(),
      option1: $('#option1').val(),
      option2: $('#option2').val(),
      option3: $('#option3').val(),
      option4: $('#option4').val(),
      correctAnswer: $('#correctAnswer').val(),
      examId: $('#examId').val()
    };

    // Validate inputs (optional)
    if (!Option.question || !Option.option1 || !Option.option2 || !Option.option3 || !Option.option4 || !Option.correctAnswer) {
      alert('All fields are required.');
      return;
    }

    // Send JSON object via AJAX
    $.ajax({
      url: baseUrl + 'questionAPI/create', // Replace with your endpoint
      method: 'POST',
      contentType: 'application/json',
      data: JSON.stringify(Option),
      success: function (response) {
       if (response.result) {
                       // alert(response.message);
                        alert('Question added successfully.');
                       // $('#question, #option1, #option2, #option3, #option4, #correctAnswer').val('');
                       window.location.reload();
                    } else {
                        alert('Operation failed: ' + response.message);
                    }
      },
      error: function (error) {
        alert('Failed to add question. Please try again.');
      }
    });
  });
});

  </script>
-->


  <script>
    $(document).ready(function () {
      $('#clearForm').on('click', function (event) {
        $('#question, #option1, #option2, #option3, #option4, #correctAnswer, #optionId').val('');
      });
    });


  </script>



  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <div  th:insert="~{include/vendor-js}"></div>
</body>

</html>